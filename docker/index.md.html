<meta charset="utf-8">
                            **Elements of Docker**
                            Stijn Heymans

# Introduction

While writing these elements I mostly used [Docker Deep
Dive](https://www.goodreads.com/book/show/39933970-docker-deep-dive) by Nigel
Poulton as a reference.

See the demo at [demo](https://github.com/sheymans/elementsOf/tree/master/docker/demo).

# The Demo App

Before we jump into containers, let's introduce the demo application, we'll be
want to run _in a container_. I'm going to use the simple web framework
[Express](expressjs.com) for [node](nodejs.org) to write an app that says `Hi`. This is a simple `hi.js`:

~~~js
const express = require('express');
const app = express();

app.get('/', (request, result) => result.send('Hi'));

app.listen(8111, () => console.log('hi: listening on port 8111'));
~~~

As I'm using `express`, I'll have a `package.json` file, that looks like this:

~~~
{
  "name": "hi",
  "version": "1.0.0",
  "author": "Stijn Heymans",
  "dependencies": {
    "express": "^4.17.1"
  }
}
~~~

You're probably used to this, so just note that I indicated that my app will need `express` in this line:

~~~
    "express": "^4.17.1"
~~~

To make sure we can run this app, we'll install that `express` dependency as follows:

~~~bash
npm install
~~~

We use the node package manager [npm](https://www.npmjs.com/) to do that. `npm`
will look at the `package.json` file, will see that there's a `dependency`
`express` and will then install `express` into the directory `node_modules`.

To start your app, then type:

~~~bash
node hi.js
~~~

You can navigate to http://localhost:8111 to be said Hi to.

Here's roughly what assumptions we made to run this app on your laptop/computer:

- Your laptop allows for running software such as `npm`, `node`.  For example, it's a Linux or Mac Os X based machine.
- You had `npm` installed to install the required dependencies of your app (`express`); if you did not have it installed, you had to go and install it.
- You then ran `npm install` from the command-line
- You had `node` installed to actually run the application
- You then ran `node hi.js` from the command-line

If you want to install and run your app on another laptop (or, on an [EC2
instance](https://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud) cause
that's how you roll), you'd repeat those steps. 

_"Well, of course, I would not repeat these steps, I'd put them all in a little
script so I just have to run the script"_. Of course you would. But you'd be
forgetten that a laptop and an EC2 instance are very different things. You'd
probably want scripts per different Operation System at the minimumn.

What if you could package your app while specifying:

- a small Operating System to start from, for example [alpine](https://alpinelinux.org/)
- an installation of `npm` and `node` layered on that
- instructions to install your application (`npm install`)
- instructions to run your application (`node hi.js`)

In other words, what if you could define a small container that specifies the
above and that you run anywhere where such containers can run? (You're getting
the container reference: a standard packaging solution that you can stuff in
there and as long as your stuff fits into a container, you can put it on a ship
and ship it off anywhere in the world).

Next up, let's see how that containerization works.

# Containerizing the App

To containerize your app, we'll use [docker](docker.com). In this article, I'll
mostly focus on what `docker` _does_ rather than _how_ it does it. If you want
to learn more about how docker does what it does, please refer to [Docker Deep
Dive]() or for more on for example `containerd` and `runc`, check out this
[blog
series](https://www.ianlewis.org/en/container-runtimes-part-1-introduction-container-r).

Central to containerizing an app is the concept of an `image`. While there's a certain mysticism around an image, fundamentally it's just an abstraction that can be understood by `docker` when it needs to actually run your application. In that sense, we can compare to several other abstractions in computer science:

- a _Java class_ specifies the behavior of a particular instance of that class
- a _`jar` file_ packages up your Java application and can then be run by the Java runtime.
- an ISO image for Linux packages up the Operation System so you can download the image, install the image, and run the Operating System
- a Python script specifies which instructions to run for the Python interpreter

All of these comparisons are imperfect, but have in common that there is the
aspect of a specification (the `image`) that can then be run/executed on a
machine.

Let's recap the aspects that we'd like to specify for our demo app:

- a small Operating System to start from, for example [alpine](https://alpinelinux.org/)
- an installation of `npm` and `node` layered on that
- instructions to install your application (`npm install`)
- instructions to run your application (`node hi.js`)

Now let's write up that specification more formally (i.e., such that `docker`
can use to build an `image`) in a file named `Dockerfile` -- specifications to
build docker images will always be in a file named `Dockerfile` so similarly as
a `package.json` can teach you a lot of how the application is structured, have
a look at `Dockerfile`s in apps you meet in the wild.




# Publishing the Container

# Running the Container

# Persistence

TODO: volumes

# Conclusion

- build: image
- execute: run

TODO: left out of discussion Docker Swarm, Docker Networking and the Container Network Model (CNM).

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-12447521-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }

  gtag('js', new Date());

  gtag('config', 'UA-12447521-1');
</script>

<link rel="stylesheet" href="https://casual-effects.com/markdeep/latest/latex.css?">
<!-- Markdeep: --><style class="fallback">body{visibility:hidden}</style><script src="https://casual-effects.com/markdeep/latest/markdeep.min.js?" charset="utf-8"></script>

